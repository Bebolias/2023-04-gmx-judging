J4de

medium

# If the `params.market` is WNT the `createWithdrawal` function will always revert

## Summary

The `createWithdrawal` use `recordTransferIn(wnt)` to calculate `executionFee`. If the `params.market` also is WNT, the `marketTokenAmount` is always `0` because that all WNT are counted as `executionFee`. Then `createWithdrawal` revert.

## Vulnerability Detail

```solidity
File: withdrawal/WithdrawalUtils.sol
110         address wnt = TokenUtils.wnt(dataStore);
111 >>      uint256 wntAmount = withdrawalVault.recordTransferIn(wnt);
112
113         if (wntAmount < params.executionFee) {
114             revert Errors.InsufficientWntAmount(wntAmount, params.executionFee);
115         }
116
117         AccountUtils.validateReceiver(params.receiver);
118
119 >>      uint256 marketTokenAmount = withdrawalVault.recordTransferIn(params.market);
120
121         if (marketTokenAmount == 0) {
122 >>          revert Errors.EmptyWithdrawalAmount();
123         }
```

- Line 111: all WNT received will be counted as `executionFee`
- Line 119: if `params.market` is WNT, the `marketTokenAmount` will always be 0
- Line 122: if `marketTokenAmount` is 0, it will revert

## Impact

`createWithdrawal` will be DOS

## Code Snippet

https://github.com/sherlock-audit/2023-04-gmx/blob/main/gmx-synthetics/contracts/withdrawal/WithdrawalUtils.sol#L110-L123

## Tool used

Manual Review

## Recommendation

```diff
        address wnt = TokenUtils.wnt(dataStore);
        uint256 wntAmount = withdrawalVault.recordTransferIn(wnt);

        if (wntAmount < params.executionFee) {
            revert Errors.InsufficientWntAmount(wntAmount, params.executionFee);
        }

        AccountUtils.validateReceiver(params.receiver);

        uint256 marketTokenAmount = withdrawalVault.recordTransferIn(params.market);
+       if (params.market == wnt) { marketTokenAmount = wntAmount - params.executionFee }

        if (marketTokenAmount == 0) {
            revert Errors.EmptyWithdrawalAmount();
        }
```