stopthecap

high

# Un-refunded gas not used during callbacks

## Summary
Un-refunded gas not used during callbacks

## Vulnerability Detail
Any user or contract interacting with GMX will not exactly pass the right number in the callback gasLimit, because it does not integrate 

Integrations don't calculate the gas in callback

```solidity
  function afterWithdrawalExecution(bytes32 key, Withdrawal.Props memory withdrawal) internal {
        if (!isValidCallbackContract(withdrawal.callbackContract())) { return; }

        try IWithdrawalCallbackReceiver(withdrawal.callbackContract()).afterWithdrawalExecution{ gas: withdrawal.callbackGasLimit() }(key, withdrawal) {
        } catch {
            emit AfterWithdrawalExecutionError(key, withdrawal);
        }
    }
```

## Impact
Bad

## Code Snippet
https://github.com/sherlock-audit/2023-04-gmx/blob/main/gmx-synthetics/contracts/callback/CallbackUtils.sol#L87-L94

## Tool used

Manual Review

## Recommendation

Calculate the gas that is actually spent on the callback contract call and calculate the difference with the gas before the call.

```solidity
 function afterWithdrawalExecution(bytes32 key, Withdrawal.Props memory withdrawal) internal returns(uint256 gasToRefund){
        if (!isValidCallbackContract(withdrawal.callbackContract())) { return; }
            uint256 gasBeforeCallback = gasleft();
        try IWithdrawalCallbackReceiver(withdrawal.callbackContract()).afterWithdrawalExecution{ gas: withdrawal.callbackGasLimit() }(key, withdrawal) {
            uint256 gasAfterCallback = gasleft();
            uint256 gasToRefund = gasBeforeCallback - gasAfterCallback;
        }catch {
            emit AfterWithdrawalExecutionError(key, withdrawal);
        }
    }
```
