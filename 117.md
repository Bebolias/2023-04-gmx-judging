Ch_301

false

# [H] [05-25 10:53] [NO IMPACT]

## Summary
[MarketUtils.validateMarketTokenBalance()]() is to validate that internal state changes are correct for a specific market 
It's compare the `expectedMinBalance` from `getExpectedMinTokenBalance()`  with `balanceOf()`  for the checked token  
```solidity
        if (balance < expectedMinBalance) {
            revert Errors.InvalidMarketTokenBalance(market.marketToken, token, balance, expectedMinBalance);
        }
```
and since the funding fees are excluded from the `expectedMinBalance`. it does an additional check for it 
```solidity
        if (balance < claimableFundingFeeAmount) {
            revert Errors.InvalidMarketTokenBalanceForClaimableFunding(market.marketToken, token, balance, claimableFundingFeeAmount);
        }
```

## Vulnerability Detail
The checking process in `validateMarketTokenBalance()` is being done incorrectly.
by checking `balance < expectedMinBalance` and `balance < claimableFundingFeeAmount` It isn't guaranteed this:
 `balance < (claimableFundingFeeAmount + expectedMinBalance)`
## Impact

## Code Snippet

## Tool used

Manual Review

## Recommendation
